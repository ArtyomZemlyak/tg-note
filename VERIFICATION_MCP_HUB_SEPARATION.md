# –ü—Ä–æ–≤–µ—Ä–∫–∞: –ë–æ—Ç –±–æ–ª—å—à–µ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç MCP Hub

## ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### 1. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

–í `docker-compose.yml` –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã **—Ç—Ä–∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞**:

```yaml
services:
  vllm-server:    # LLM —Å–µ—Ä–≤–µ—Ä –¥–ª—è mem-agent
  mcp-hub:        # MCP Hub - –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
  bot:            # Telegram –±–æ—Ç
```

### 2. MCP Hub –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å

**`mcp-hub` –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä** (—Å—Ç—Ä–æ–∫–∏ 45-80):
- –°–æ–±–∏—Ä–∞–µ—Ç—Å—è –∏–∑ `Dockerfile.hub`
- –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–æ–π: `python -m src.mcp.mcp_hub_server`
- –°–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç `8765`
- –ò–º–µ–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π healthcheck: `http://localhost:8765/health`
- **–†–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –±–æ—Ç–∞**

### 3. Bot —Ç–æ–ª—å–∫–æ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ MCP Hub

**`bot` –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä** (—Å—Ç—Ä–æ–∫–∏ 83-115):
- –°–æ–±–∏—Ä–∞–µ—Ç—Å—è –∏–∑ `Dockerfile.bot`
- –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–æ–π: `python main.py`
- –ü–æ–ª—É—á–∞–µ—Ç URL –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è:
  ```yaml
  environment:
    - MCP_HUB_URL=http://mcp-hub:8765/sse
  ```
- –ó–∞–≤–∏—Å–∏—Ç –æ—Ç `mcp-hub` —á–µ—Ä–µ–∑ `depends_on`:
  ```yaml
  depends_on:
    mcp-hub:
      condition: service_healthy
  ```

### 4. –õ–æ–≥–∏–∫–∞ –≤ –∫–æ–¥–µ –±–æ—Ç–∞

–í `src/mcp/server_manager.py` (—Å—Ç—Ä–æ–∫–∏ 280-295):

```python
if self.settings.AGENT_ENABLE_MCP_MEMORY:
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø—É—â–µ–Ω –ª–∏ –±–æ—Ç –≤ Docker
    mcp_hub_url = os.getenv("MCP_HUB_URL")
    
    if mcp_hub_url:
        # Docker —Ä–µ–∂–∏–º: –¢–û–õ–¨–ö–û –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É mcp-hub
        logger.info(f"Docker mode: Connecting to mcp-hub at {mcp_hub_url}")
        self._setup_mcp_hub_connection(mcp_hub_url)
    else:
        # Standalone —Ä–µ–∂–∏–º: –∑–∞–ø—É—Å–∫ mcp-hub –∫–∞–∫ subprocess
        logger.info("Standalone mode: Registering memory HTTP server subprocess")
        self._setup_memory_subprocess()
```

**–í Docker —Ä–µ–∂–∏–º–µ** (`_setup_mcp_hub_connection`, —Å—Ç—Ä–æ–∫–∏ 301-335):
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª `data/mcp_servers/memory.json`
- ‚úÖ –£–∫–∞–∑—ã–≤–∞–µ—Ç URL —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ MCP Hub
- ‚ùå **–ù–ï –∑–∞–ø—É—Å–∫–∞–µ—Ç** –Ω–∏–∫–∞–∫–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- ‚ùå **–ù–ï –≤—ã–∑—ã–≤–∞–µ—Ç** `subprocess.Popen`

**–í Standalone —Ä–µ–∂–∏–º–µ** (`_setup_memory_subprocess`, —Å—Ç—Ä–æ–∫–∏ 336-409):
- –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç mcp-hub –∫–∞–∫ subprocess —á–µ—Ä–µ–∑ `self.register_server()`
- –í—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ `MCP_HUB_URL` **–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç**

### 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏

Bot –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å MCP Hub —á–µ—Ä–µ–∑:

1. **Docker healthcheck** - –±–æ—Ç –Ω–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç –ø–æ–∫–∞ mcp-hub –Ω–µ —Å—Ç–∞–Ω–µ—Ç healthy
2. **HTTP –∑–∞–ø—Ä–æ—Å—ã** - –±–æ—Ç –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ `http://mcp-hub:8765/sse`
3. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** - —Å–æ–∑–¥–∞–µ—Ç config —Ñ–∞–π–ª —Å URL –¥–ª—è SSE —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞

## üìã –í—ã–≤–æ–¥—ã

### ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ:

1. **MCP Hub - –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä** —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º Dockerfile
2. **Bot –ù–ï –∑–∞–ø—É—Å–∫–∞–µ—Ç mcp-hub** –≤ Docker —Ä–µ–∂–∏–º–µ
3. **Bot —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å** —á–µ—Ä–µ–∑ healthcheck –∏ URL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
4. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**:
   - `mcp-hub` –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä: –∑–∞–ø—É—Å–∫ –∏ —Ä–∞–±–æ—Ç–∞ MCP Hub —Å–µ—Ä–≤–µ—Ä–∞
   - `bot` –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä: –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MCP Hub –∫–∞–∫ –∫ –≤–Ω–µ—à–Ω–µ–º—É —Å–µ—Ä–≤–∏—Å—É

### üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:

- –ü—É—Ç—å –∫ –º–æ–¥—É–ª—é –≤ `Dockerfile.hub` –∏—Å–ø—Ä–∞–≤–ª–µ–Ω —Å `src.agents.mcp.mcp_hub_server` –Ω–∞ `src.mcp.mcp_hub_server`

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  vllm-server    ‚îÇ  –ü–æ—Ä—Ç: 8001
‚îÇ  (LLM)          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  mcp-hub        ‚îÇ  –ü–æ—Ä—Ç: 8765
‚îÇ  (MCP Gateway)  ‚îÇ  ‚Üê –û—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚Üì HTTP/SSE –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  bot            ‚îÇ
‚îÇ  (Telegram Bot) ‚îÇ  ‚Üê –¢–æ–ª—å–∫–æ –ü–û–î–ö–õ–Æ–ß–ê–ï–¢–°–Ø –∫ mcp-hub, –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç –µ–≥–æ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏: –£–°–ü–ï–®–ù–û

–ë–æ—Ç-—Å–µ—Ä–≤–∏—Å **–±–æ–ª—å—à–µ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç** mcp-hub —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ.  
MCP Hub - —ç—Ç–æ **–æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä**, –∫–æ—Ç–æ—Ä—ã–π **—Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç**.  
–ë–æ—Ç **—Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å** –∏ **–ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è** –∫ –Ω–µ–º—É.
