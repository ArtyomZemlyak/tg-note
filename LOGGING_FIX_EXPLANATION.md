# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –ø—É—Å—Ç—ã–º–∏ –ª–æ–≥–∞–º–∏

## üêõ –ü—Ä–æ–±–ª–µ–º–∞

–õ–æ–≥–∏ –≤ —Ñ–∞–π–ª–∞—Ö `logs/memory_http.log` –∏ `logs/mlx_server.log` –æ—Å—Ç–∞–≤–∞–ª–∏—Å—å –ø—É—Å—Ç—ã–º–∏, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–æ, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä—ã –±—ã–ª–∏ –∑–∞–ø—É—â–µ–Ω—ã.

## üîç –ü—Ä–∏—á–∏–Ω—ã

### 1. **memory_server_http.py** - –î–≤–æ–π–Ω–æ–π –≤—ã–∑–æ–≤ `logger.remove()`

**–§–∞–π–ª:** `src/agents/mcp/memory/memory_server_http.py`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
# –°—Ç—Ä–æ–∫–∞ 39 - –≤ –Ω–∞—á–∞–ª–µ –º–æ–¥—É–ª—è
logger.remove()
logger.add(log_dir / "memory_http.log", level="DEBUG", ...)  # –î–æ–±–∞–≤–∏–ª–∏ —Ñ–∞–π–ª–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫

# ...

# –°—Ç—Ä–æ–∫–∏ 297-302 - –≤ —Ñ—É–Ω–∫—Ü–∏–∏ main()
def main():
    args = parser.parse_args()
    
    logger.remove()  # ‚ùå –£–î–ê–õ–Ø–ï–¢ –í–°–ï –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò, –≤–∫–ª—é—á–∞—è —Ñ–∞–π–ª–æ–≤—ã–µ!
    logger.add(sys.stderr, level=args.log_level)  # –î–æ–±–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Å–æ–ª—å–Ω—ã–π
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–µ—Ä–∞ —Ñ—É–Ω–∫—Ü–∏—è `main()` –≤—ã–∑—ã–≤–∞–µ—Ç `logger.remove()`
- –≠—Ç–æ —É–¥–∞–ª—è–µ—Ç —Ñ–∞–π–ª–æ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏, –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –≤ –Ω–∞—á–∞–ª–µ –º–æ–¥—É–ª—è
- –õ–æ–≥–∏ –∏–¥—É—Ç **—Ç–æ–ª—å–∫–æ –≤ –∫–æ–Ω—Å–æ–ª—å** (stderr), –Ω–æ –Ω–µ –≤ —Ñ–∞–π–ª—ã

### 2. **agent.py** - –ü—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ —Ñ–∞–π–ª–æ–≤

**–§–∞–π–ª:** `src/agents/mcp/memory/mem_agent_impl/agent.py`

**–ü—Ä–æ–±–ª–µ–º–∞ —Å MLX —Å–µ—Ä–≤–µ—Ä–æ–º (—Å—Ç—Ä–æ–∫–∏ 239-258):**
```python
try:
    with open(mlx_log_file, "a") as log_f, open(mlx_error_file, "a") as err_f:
        log_f.write("=== MLX server startup ===\n")
        
        subprocess.Popen(
            ["mlx_lm", "serve", ...],
            stdout=log_f,
            stderr=err_f,
        )
    # ‚ùå –ó–î–ï–°–¨ –±–ª–æ–∫ with –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –∏ —Ñ–∞–π–ª—ã –ó–ê–ö–†–´–í–ê–Æ–¢–°–Ø!
    # –ü—Ä–æ—Ü–µ—Å—Å mlx_lm –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å, –Ω–æ –Ω–µ –º–æ–∂–µ—Ç –ø–∏—Å–∞—Ç—å –≤ –∑–∞–∫—Ä—ã—Ç—ã–µ —Ñ–∞–π–ª—ã
```

**–ê–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Å vLLM —Å–µ—Ä–≤–µ—Ä–æ–º (—Å—Ç—Ä–æ–∫–∏ 179-198)**

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –§–∞–π–ª—ã –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è, –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –∑–∞–≥–æ–ª–æ–≤–æ–∫
- –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è subprocess
- –ë–ª–æ–∫ `with` –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –∏ **–∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Ñ–∞–π–ª—ã**
- Subprocess –ø—ã—Ç–∞–µ—Ç—Å—è –ø–∏—Å–∞—Ç—å –≤ –∑–∞–∫—Ä—ã—Ç—ã–µ —Ñ–∞–π–ª—ã ‚Üí –ª–æ–≥–∏ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ `memory_server_http.py`

```python
# –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–ª–∏ –ø—Ä–æ–±–ª–µ–º–Ω—ã–π –∫–æ–¥ –≤ main()
def main():
    args = parser.parse_args()
    
    # Configure logging level
    # NOTE: Don't call logger.remove() here - file handlers are already configured at module level
    # Just update the log level if needed
    # logger.remove()
    # logger.add(
    #     sys.stderr,
    #     format="...",
    #     level=args.log_level,
    # )
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –§–∞–π–ª–æ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏, –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –≤ –Ω–∞—á–∞–ª–µ –º–æ–¥—É–ª—è, –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
- –õ–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `logs/memory_http.log` –∏ `logs/memory_http_errors.log`

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ `agent.py`

**–î–ª—è MLX —Å–µ—Ä–≤–µ—Ä–∞:**
```python
# Open log files (keep them open for the subprocess)
log_f = open(mlx_log_file, "a")
err_f = open(mlx_error_file, "a")

log_f.write(f"\n=== MLX server startup at {time.strftime('%Y-%m-%d %H:%M:%S')} ===\n")
err_f.write(f"\n=== MLX server startup at {time.strftime('%Y-%m-%d %H:%M:%S')} ===\n")
log_f.flush()
err_f.flush()

subprocess.Popen(
    ["mlx_lm", "serve", ...],
    stdout=log_f,
    stderr=err_f,
)
# ‚úÖ –§–∞–π–ª—ã –æ—Å—Ç–∞—é—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—ã–º–∏ –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–∞
```

**–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è vLLM —Å–µ—Ä–≤–µ—Ä–∞**

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –§–∞–π–ª—ã –æ—Å—Ç–∞—é—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—ã–º–∏ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ subprocess
- –ü—Ä–æ—Ü–µ—Å—Å—ã –º–æ–≥—É—Ç –ø–∏—Å–∞—Ç—å –≤ –Ω–∏—Ö –ª–æ–≥–∏
- –õ–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `logs/mlx_server.log` –∏ `logs/vllm_server.log`

## üìä –ò—Ç–æ–≥–æ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

1. **`src/agents/mcp/memory/memory_server_http.py`**
   - –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω `logger.remove()` –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `main()`
   - –§–∞–π–ª–æ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ª–æ–≥–æ–≤ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

2. **`src/agents/mcp/memory/mem_agent_impl/agent.py`**
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞–º–∏ –¥–ª—è MLX —Å–µ—Ä–≤–µ—Ä–∞ (—Å—Ç—Ä–æ–∫–∏ 239-263)
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞–º–∏ –¥–ª—è vLLM —Å–µ—Ä–≤–µ—Ä–∞ (—Å—Ç—Ä–æ–∫–∏ 179-203)
   - –§–∞–π–ª—ã –æ—Å—Ç–∞—é—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—ã–º–∏ –¥–ª—è subprocess

## üéØ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –ª–æ–≥–∏ –¥–æ–ª–∂–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è:

```bash
# Memory HTTP —Å–µ—Ä–≤–µ—Ä
tail -f logs/memory_http.log
tail -f logs/memory_http_errors.log

# MLX —Å–µ—Ä–≤–µ—Ä (macOS)
tail -f logs/mlx_server.log
tail -f logs/mlx_server_errors.log

# vLLM —Å–µ—Ä–≤–µ—Ä (Linux)
tail -f logs/vllm_server.log
tail -f logs/vllm_server_errors.log
```

## üí° –£—Ä–æ–∫–∏

1. **–ù–µ –≤—ã–∑—ã–≤–∞–π—Ç–µ `logger.remove()` –ø–æ–≤—Ç–æ—Ä–Ω–æ** –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ–≥–≥–µ—Ä–æ–≤
2. **–î–µ—Ä–∂–∏—Ç–µ —Ñ–∞–π–ª—ã –æ—Ç–∫—Ä—ã—Ç—ã–º–∏** –¥–ª—è subprocess, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `with` 
3. **–í—Å–µ–≥–¥–∞ –≤—ã–∑—ã–≤–∞–π—Ç–µ `flush()`** –ø–æ—Å–ª–µ –∑–∞–ø–∏—Å–∏, —á—Ç–æ–±—ã –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å
4. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

## üîß –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ runtime:
```python
# –í–º–µ—Å—Ç–æ logger.remove() + logger.add()
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ configure –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
from loguru import logger

def update_log_level(level: str):
    # –û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
    logger.configure(handlers=[
        {"sink": sys.stderr, "level": level},
        {"sink": "logs/app.log", "level": level},
    ])
```
