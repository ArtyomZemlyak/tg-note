# –ò—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞: –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –≤ Docker Compose

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –°–æ–∑–¥–∞–Ω docker-compose.vector.yml
**–§–∞–π–ª**: `docker-compose.vector.yml`
**–°–æ–¥–µ—Ä–∂–∏—Ç**:
- ‚úÖ Qdrant (–≤–µ–∫—Ç–æ—Ä–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)
- ‚úÖ Infinity (—Å–µ—Ä–≤–∏—Å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –æ—Ç michaelfeil/infinity)
- ‚úÖ MCP Hub —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
- ‚úÖ Telegram Bot —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
- ‚úÖ Health checks –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- ‚úÖ Persistent volumes –¥–ª—è –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –°–µ—Ç–µ–≤–∞—è –∏–∑–æ–ª—è—Ü–∏—è

### 2. –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ –∫–æ–¥–µ
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `src/vector_search/`

‚úÖ **InfinityEmbedder** (`embeddings.py`):
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Infinity API
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –±–∞—Ç—á–∏–Ω–≥–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏

‚úÖ **QdrantVectorStore** (`vector_stores.py`):
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Qdrant API
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–π
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º

‚úÖ **VectorSearchFactory** (`factory.py`):
- –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

‚úÖ **MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã** (`src/mcp/mcp_hub_server.py`):
- `vector_search` - —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫
- `reindex_vector` - –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π

### 3. –°–æ–∑–¥–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
**–§–∞–π–ª—ã**:
- `docs_site/deployment/docker-vector-search.md` - –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (17KB)
- `.env.vector.example` - –ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (7.2KB)
- `VECTOR_SEARCH_QUICKSTART.md` - –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (7.6KB)

### 4. –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
**–§–∞–π–ª**: `config/settings.py`

‚úÖ –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç:
```python
VECTOR_SEARCH_ENABLED: bool
VECTOR_EMBEDDING_PROVIDER: str  # sentence_transformers, openai, infinity
VECTOR_EMBEDDING_MODEL: str
VECTOR_INFINITY_API_URL: str
VECTOR_INFINITY_API_KEY: Optional[str]
VECTOR_STORE_PROVIDER: str  # faiss, qdrant
VECTOR_QDRANT_URL: str
VECTOR_QDRANT_API_KEY: Optional[str]
VECTOR_QDRANT_COLLECTION: str
```

## üìã –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Telegram Bot    ‚îÇ  ‚Üê –£–ø—Ä–∞–≤–ª—è–µ—Ç –ª–æ–≥–∏–∫–æ–π –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
‚îÇ  (tg-note-bot)   ‚îÇ    (–∫–æ–≥–¥–∞ –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å, –∫–æ–≥–¥–∞ –∏—Å–∫–∞—Ç—å)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ    MCP Hub       ‚îÇ  ‚Üê –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:
‚îÇ  (tg-note-hub)   ‚îÇ    - vector_search
‚îÇ                  ‚îÇ    - reindex_vector
‚îî‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îò
    ‚îÇ          ‚îÇ
    ‚ñº          ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Infinity‚îÇ  ‚îÇ  Qdrant  ‚îÇ
‚îÇ(embeddi ‚îÇ  ‚îÇ (vector  ‚îÇ
‚îÇ  ngs)   ‚îÇ  ‚îÇ  store)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üîÑ –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

1. **Bot** –ø–æ–ª—É—á–∞–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. **Bot** –≤—ã–∑—ã–≤–∞–µ—Ç `reindex_vector` —á–µ—Ä–µ–∑ MCP Hub
3. **MCP Hub** —Ä–∞–∑–±–∏–≤–∞–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –Ω–∞ —á–∞–Ω–∫–∏
4. **MCP Hub** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —á–∞–Ω–∫–∏ –≤ **Infinity** –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
5. **MCP Hub** —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤–µ–∫—Ç–æ—Ä—ã –≤ **Qdrant** (–æ—Ç–¥–µ–ª—å–Ω–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è –¥–ª—è –∫–∞–∂–¥–æ–π –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π)
6. –ü—Ä–∏ –ø–æ–∏—Å–∫–µ **Bot** –≤—ã–∑—ã–≤–∞–µ—Ç `vector_search`
7. **MCP Hub** —Å–æ–∑–¥–∞–µ—Ç —ç–º–±–µ–¥–¥–∏–Ω–≥ –∑–∞–ø—Ä–æ—Å–∞ —á–µ—Ä–µ–∑ **Infinity**
8. **MCP Hub** –∏—â–µ—Ç –ø–æ—Ö–æ–∂–∏–µ –≤–µ–∫—Ç–æ—Ä—ã –≤ **Qdrant**
9. **Bot** –ø–æ–ª—É—á–∞–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫

```bash
# 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
cp .env.vector.example .env
cp config.example.yaml config.yaml
mkdir -p data/qdrant_storage data/infinity_cache

# 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env (–¥–æ–±–∞–≤–∏—Ç—å TELEGRAM_BOT_TOKEN)

# 3. –í config.yaml –≤–∫–ª—é—á–∏—Ç—å:
# VECTOR_SEARCH_ENABLED: true

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å
docker-compose -f docker-compose.vector.yml up -d

# 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker-compose -f docker-compose.vector.yml logs -f
```

## üìä –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### Qdrant
- **–ü–æ—Ä—Ç**: 6333 (HTTP), 6334 (gRPC)
- **–•—Ä–∞–Ω–∏–ª–∏—â–µ**: `./data/qdrant_storage`
- **–§—É–Ω–∫—Ü–∏–∏**: –•—Ä–∞–Ω–µ–Ω–∏–µ –∏ –ø–æ–∏—Å–∫ –≤–µ–∫—Ç–æ—Ä–æ–≤
- **–ö–æ–ª–ª–µ–∫—Ü–∏–∏**: –û—Ç–¥–µ–ª—å–Ω–∞—è –¥–ª—è –∫–∞–∂–¥–æ–π –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π

### Infinity
- **–ü–æ—Ä—Ç**: 7997
- **–ú–æ–¥–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**: `BAAI/bge-small-en-v1.5`
- **–•—Ä–∞–Ω–∏–ª–∏—â–µ**: `./data/infinity_cache`
- **–§—É–Ω–∫—Ü–∏–∏**: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –∏–∑ —Ç–µ–∫—Å—Ç–∞

### MCP Hub
- **–ü–æ—Ä—Ç**: 8765
- **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã**:
  - `vector_search(query, top_k)` - –ø–æ–∏—Å–∫
  - `reindex_vector(force)` - –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: Qdrant + Infinity

## üéØ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –±–∞–∑ –∑–Ω–∞–Ω–∏–π
–ö–∞–∂–¥–∞—è –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–ª—É—á–∞–µ—Ç —Å–≤–æ—é –∫–æ–ª–ª–µ–∫—Ü–∏—é –≤ Qdrant:
- `knowledge_base_user_123_notes`
- `knowledge_base_user_456_work`

### ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Infinity
- –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Infinity API
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏
- –ë–∞—Ç—á–∏–Ω–≥ –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è

### ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Qdrant
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–π
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- Persistence –Ω–∞ –¥–∏—Å–∫–µ

### ‚úÖ MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
- –í—Å—Ç—Ä–æ–µ–Ω—ã –≤ MCP Hub
- –î–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π MCP –ø—Ä–æ—Ç–æ–∫–æ–ª
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

1. **–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: `docs_site/deployment/docker-vector-search.md`
   - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞
   - –ú–æ–¥–µ–ª–∏
   - –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
   - Troubleshooting

2. **–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç**: `VECTOR_SEARCH_QUICKSTART.md`
   - –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
   - –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫
   - –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

3. **–ü—Ä–∏–º–µ—Ä .env**: `.env.vector.example`
   - –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
   - –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –ø—Ä–∏–º–µ—Ä—ã
   - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ config.yaml

```yaml
# –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫
VECTOR_SEARCH_ENABLED: true

# –≠–º–±–µ–¥–¥–∏–Ω–≥–∏
VECTOR_EMBEDDING_PROVIDER: infinity
VECTOR_EMBEDDING_MODEL: BAAI/bge-small-en-v1.5
VECTOR_INFINITY_API_URL: http://infinity:7997

# –í–µ–∫—Ç–æ—Ä–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
VECTOR_STORE_PROVIDER: qdrant
VECTOR_QDRANT_URL: http://qdrant:6333
VECTOR_QDRANT_COLLECTION: knowledge_base

# –ß–∞–Ω–∫–∏–Ω–≥
VECTOR_CHUNKING_STRATEGY: fixed_size_overlap
VECTOR_CHUNK_SIZE: 512
VECTOR_CHUNK_OVERLAP: 50

# –ü–æ–∏—Å–∫
VECTOR_SEARCH_TOP_K: 5
```

## üé® –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –º–æ–¥–µ–ª–∏

### –î–ª—è —Ä—É—Å—Å–∫–æ–≥–æ + –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ
```env
INFINITY_MODEL=BAAI/bge-m3
```

### –î–ª—è –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ (–±—ã—Å—Ç—Ä–µ–µ)
```env
INFINITY_MODEL=BAAI/bge-small-en-v1.5
```

## ‚úÖ –í—Å–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –Ω–∞ –º–µ—Å—Ç–µ

- ‚úÖ Infinity API –≤ `src/vector_search/embeddings.py`
- ‚úÖ Qdrant API –≤ `src/vector_search/vector_stores.py`
- ‚úÖ Factory –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- ‚úÖ MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –≤ `src/mcp/mcp_hub_server.py`
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `config/settings.py`

## üéì AICODE-NOTE

**–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:**
- **Bot** –¥–µ—Ä–∂–∏—Ç –ª–æ–≥–∏–∫—É –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—é —Ç–µ–∫—Å—Ç–∞ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π, –∫–æ–≥–¥–∞ –æ–±–Ω–æ–≤–ª—è—Ç—å
- **MCP Hub** –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —á–µ—Ä–µ–∑ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã vector_search –∏ reindex_vector
- **Qdrant** —Ö—Ä–∞–Ω–∏—Ç –≤–µ–∫—Ç–æ—Ä—ã –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—è—Ö (–æ—Ç–¥–µ–ª—å–Ω–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è –¥–ª—è –∫–∞–∂–¥–æ–π –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π)
- **Infinity** –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –∏–∑ —Ç–µ–∫—Å—Ç–∞

–í—Å—ë –≥–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üöÄ
