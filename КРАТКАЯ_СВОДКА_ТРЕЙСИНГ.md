# –î–æ–±–∞–≤–ª–µ–Ω –ø–æ–ª–Ω—ã–π —Ç—Ä–µ–π—Å–∏–Ω–≥ –¥–ª—è MCP Memory Server –∏ Mem-Agent

## –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ ‚úÖ

–î–æ–±–∞–≤–ª–µ–Ω **–¥–µ—Ç–∞–ª—å–Ω—ã–π —Ç—Ä–µ–π—Å–∏–Ω–≥** –≤–æ –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã MCP memory server –∏ mem-agent –¥–ª—è –ø–æ–ª–Ω–æ–π –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã.

## –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (7 —Ñ–∞–π–ª–æ–≤)

1. ‚úÖ `src/agents/mcp/memory/memory_server.py` - MCP —Å–µ—Ä–≤–µ—Ä (STDIO)
2. ‚úÖ `src/agents/mcp/memory/memory_server_http.py` - MCP —Å–µ—Ä–≤–µ—Ä (HTTP)
3. ‚úÖ `src/agents/mcp/memory/mem_agent_impl/mcp_server.py` - Mem-agent MCP —Å–µ—Ä–≤–µ—Ä
4. ‚úÖ `src/agents/mcp/memory/mem_agent_impl/agent.py` - –Ø–¥—Ä–æ mem-agent
5. ‚úÖ `src/agents/mcp/memory/mem_agent_impl/model.py` - –ö–ª–∏–µ–Ω—Ç –º–æ–¥–µ–ª–∏
6. ‚úÖ `src/agents/mcp/memory/memory_factory.py` - –§–∞–±—Ä–∏–∫–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â
7. ‚úÖ `src/agents/mcp/memory/memory_mem_agent_storage.py` - MemAgent storage

## –ß—Ç–æ —Ç–µ–ø–µ—Ä—å –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è üìä

### –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ:
- üöÄ –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ —Å –ø–æ–ª–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
- üíæ –¢–∏–ø —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ (JSON/Vector/Mem-Agent)
- üì¶ –ú–æ–¥–µ–ª—å
- üéÆ Backend (vLLM/MLX/OpenRouter/auto)
- üìÅ –ü—É—Ç–∏ –∫ –¥–∞–Ω–Ω—ã–º
- üîß –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚öôÔ∏è –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –í–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:
- üì• **–ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å** (—Å ID, –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏, content preview)
- üîß **–ö–∞–∂–¥—ã–π –≤—ã–∑–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞** (store/retrieve/list/chat/query)
- üë• **User ID** (–¥–ª—è multi-user —Ä–µ–∂–∏–º–∞)
- üìä **–†–∞–∑–º–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö** (–¥–ª–∏–Ω–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤)
- üß† **–û–±—Ä–∞—â–µ–Ω–∏—è –∫ –º–æ–¥–µ–ª–∏** (–∑–∞–ø—Ä–æ—Å ‚Üí –æ—Ç–≤–µ—Ç)
- üêç **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–¥–∞** (–≤ mem-agent)
- üîÑ **Tool turns** (–∏—Ç–µ—Ä–∞—Ü–∏–∏ –∞–≥–µ–Ω—Ç–∞)
- ‚úÖ **–£—Å–ø–µ—à–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ** –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚ùå **–í—Å–µ –æ—à–∏–±–∫–∏** —Å –ø–æ–ª–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –∏ stack trace

### –î–µ—Ç–∞–ª–∏ –º–æ–¥–µ–ª–µ–π:
- üîå –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ (OpenAI/vLLM)
- üì§ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞
- üìä –†–∞–∑–º–µ—Ä –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- üì• –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞
- üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤ (–æ—Ü–µ–Ω–∫–∞)

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å üõ†Ô∏è

### –°–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏:

```bash
# Memory MCP Server (STDIO)
tail -f logs/memory_mcp.log
tail -f logs/memory_mcp_errors.log

# Memory HTTP Server  
tail -f logs/memory_http.log
tail -f logs/memory_http_errors.log

# Mem-Agent MCP Server
tail -f logs/mem_agent_mcp_server.log
tail -f logs/mem_agent_mcp_server_errors.log

# Mem-Agent Core
tail -f logs/mem_agent.log
tail -f logs/mem_agent_errors.log

# vLLM Server (–µ—Å–ª–∏ –∑–∞–ø—É—Å—Ç–∏–ª—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
tail -f logs/vllm_server.log
tail -f logs/vllm_server_errors.log
```

### –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å DEBUG –ª–æ–≥–∞–º–∏:

```bash
# –î–ª—è STDIO —Å–µ—Ä–≤–µ—Ä–∞
python -m src.agents.mcp.memory.memory_server --log-level DEBUG

# –î–ª—è HTTP —Å–µ—Ä–≤–µ—Ä–∞
python -m src.agents.mcp.memory.memory_server_http --log-level DEBUG

# –° –ø–æ–ª–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π mem-agent
export MEM_AGENT_STORAGE_TYPE=mem-agent
export MEM_AGENT_MODEL=driaforall/mem-agent
export MEM_AGENT_BACKEND=vllm
export MEM_AGENT_MAX_TOOL_TURNS=20

python -m src.agents.mcp.memory.memory_server_http --log-level DEBUG
```

## –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞ üìã

```
================================================================================
üöÄ STARTING MCP MEMORY SERVER (HTTP/SSE)
================================================================================

üîß Server Configuration:
  üèóÔ∏è  Host: 127.0.0.1
  üîå Port: 8765
  üë• Mode: Multi-user (per-user storage)
  üíæ Storage type: mem-agent
  üéÆ Backend: vllm
  üì¶ Model: driaforall/mem-agent

üìã Environment Variables:
  - MEM_AGENT_STORAGE_TYPE: mem-agent
  - MEM_AGENT_MODEL: driaforall/mem-agent
  - MEM_AGENT_BACKEND: vllm
  - MEM_AGENT_MAX_TOOL_TURNS: 20

‚ÑπÔ∏è  Note: Each user's storage is isolated at data/memory/user_{user_id}/
================================================================================

============================================================
üöÄ INITIALIZING STORAGE FOR USER 12345
============================================================
üìÅ Data directory: /workspace/data/memory/user_12345
üíæ Storage type: mem-agent

üìã Configuration:
  - MEM_AGENT_STORAGE_TYPE: mem-agent
  - MEM_AGENT_MODEL: driaforall/mem-agent
  - MEM_AGENT_BACKEND: vllm

üîß Creating mem-agent storage via factory...
  üì¶ Model: driaforall/mem-agent
  üéÆ Backend: vllm
‚úÖ Successfully created mem-agent storage for user 12345
============================================================

üíæ STORE_MEMORY called
  User: 12345
  Category: tasks
  Content length: 156 chars
  
üí¨ Chatting with agent to store information...

================================================================================
üí¨ MEM-AGENT CHAT STARTED
================================================================================
  Message length: 156 chars
  Memory path: /workspace/data/memory/user_12345
  Model: driaforall/mem-agent
================================================================================

üß† Getting model response (model=driaforall/mem-agent, use_vllm=True)
‚úÖ Model response received: 342 chars
  Thoughts: Yes (89 chars)
  Reply: Yes (124 chars)
  Python code: Yes (129 chars)

üêç Executing Python code...
‚úÖ Code executed successfully

üîÑ Starting tool execution loop (max_turns=20)

================================================================================
‚úÖ MEM-AGENT CHAT COMPLETED
  Final reply length: 124 chars
================================================================================

‚úÖ Store completed successfully
```

## Emoji –º–∞—Ä–∫–µ—Ä—ã üé®

- üöÄ - –ó–∞–ø—É—Å–∫/–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
- ‚úÖ - –£—Å–ø–µ—Ö
- ‚ùå - –û—à–∏–±–∫–∞  
- ‚ö†Ô∏è - –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
- üìä - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞/–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- üì• - –í—Ö–æ–¥—è—â–∏–π –∑–∞–ø—Ä–æ—Å
- üì§ - –ò—Å—Ö–æ–¥—è—â–∏–π –æ—Ç–≤–µ—Ç
- üîß - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- üí¨ - –ß–∞—Ç/–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è
- üîç - –ü–æ–∏—Å–∫/–ó–∞–ø—Ä–æ—Å
- üíæ - –û–ø–µ—Ä–∞—Ü–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
- üß† - –û–ø–µ—Ä–∞—Ü–∏—è –º–æ–¥–µ–ª–∏
- üêç - –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ Python –∫–æ–¥–∞
- üîÑ - –¶–∏–∫–ª/–ò—Ç–µ—Ä–∞—Ü–∏—è
- ‚ôªÔ∏è - –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ/Cache hit

## –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è üìà

- **INFO**: –û—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–∑–∞–ø—É—Å–∫, –≤—ã–∑–æ–≤—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤, –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ)
- **DEBUG**: –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –ø—Ä–µ–≤—å—é, –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —à–∞–≥–∏)
- **ERROR**: –û—à–∏–±–∫–∏ —Å –ø–æ–ª–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –∏ stack traces

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ üéØ

1. **–ü–æ–ª–Ω–∞—è –≤–∏–¥–∏–º–æ—Å—Ç—å**: –ö–∞–∂–¥–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è –æ—Ç –Ω–∞—á–∞–ª–∞ –¥–æ –∫–æ–Ω—Ü–∞
2. **–õ—ë–≥–∫–∞—è –æ—Ç–ª–∞–¥–∫–∞**: –î–µ—Ç–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**: –†–∞–∑–º–µ—Ä—ã –æ—Ç–≤–µ—Ç–æ–≤ –∏ —Å—á—ë—Ç—á–∏–∫–∏ –æ–ø–µ—Ä–∞—Ü–∏–π
4. **–í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**: –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
5. **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**: Multi-user –æ–ø–µ—Ä–∞—Ü–∏–∏ —á—ë—Ç–∫–æ –º–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω—ã
6. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–æ–¥–µ–ª–µ–π**: –ó–∞–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã –º–æ–¥–µ–ª–µ–π –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è
7. **–í–∏–¥–∏–º–æ—Å—Ç—å —Ç–∏–ø–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞**: –ß—ë—Ç–∫–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ —Ä–µ–∂–∏–º–∞ JSON/Vector/Mem-Agent

## –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –æ—Å—Ç–∞—é—Ç—Å—è üîç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `logs/`
2. –ò—â–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö —Å –º–∞—Ä–∫–µ—Ä–æ–º ‚ùå
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å environment variables
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –º–æ–¥–µ–ª–µ–π
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ç–µ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è API endpoints
6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ data –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è–º

## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π üìä

- **7 —Ñ–∞–π–ª–æ–≤** –∏–∑–º–µ–Ω–µ–Ω–æ
- **400+ —Å—Ç—Ä–æ–∫** –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–æ
- **87 logger –≤—ã–∑–æ–≤–æ–≤** –≤ memory_server.py
- **79 logger –≤—ã–∑–æ–≤–æ–≤** –≤ memory_server_http.py
- **84 logger –≤—ã–∑–æ–≤–∞** –≤ agent.py
- **56 logger –≤—ã–∑–æ–≤–æ–≤** –≤ mcp_server.py
- **24 logger –≤—ã–∑–æ–≤–∞** –≤ model.py
- **32 logger –≤—ã–∑–æ–≤–∞** –≤ memory_factory.py
- **47 logger –≤—ã–∑–æ–≤–æ–≤** –≤ memory_mem_agent_storage.py

**–ò—Ç–æ–≥–æ: 409 logger –≤—ã–∑–æ–≤–æ–≤** –≤–æ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö! üéâ
